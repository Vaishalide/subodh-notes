<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title>NoteHub | SS Jain Subodh PG College Notes</title>
    <link rel="icon" href="/static/logo.jpg" type="image/jpeg"> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = { theme: { extend: { colors: { brand: '#4F46E5' } } } }
    </script>
    <style>
        .notice-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .new-tag { animation: blink 1.5s infinite; }
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; background-color: white; min-width: 200px; box-shadow: 0px 10px 25px rgba(0,0,0,0.15); z-index: 50; border-radius: 8px; top: 100%; left: 0; margin-top: 5px; border: 1px solid #f3f4f6; }
        .dropdown:hover .dropdown-content { display: block; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans flex flex-col min-h-screen">

    <header class="bg-white shadow sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 flex flex-wrap justify-between items-center py-3">
            <a href="/" class="flex items-center text-brand font-bold text-xl mr-6" onclick="resetPage()">
                <img src="/logo.jpg" alt="Logo" class="h-10 w-10 rounded-full mr-2 object-cover border border-gray-200">
                NoteHub
            </a>

            <nav class="flex flex-wrap items-center gap-4 md:gap-6 mt-2 md:mt-0">
                <div class="dropdown">
                    <button class="text-gray-600 hover:text-brand font-medium flex items-center py-2">
                        <i class="fas fa-book mr-1"></i> Syllabus <i class="fas fa-chevron-down ml-1 text-xs"></i>
                    </button>
                    <div class="dropdown-content">
                        <a onclick="loadSyllabus('UG')" class="block px-4 py-3 hover:bg-gray-50 hover:text-brand cursor-pointer transition border-b border-gray-100">Under Graduate</a>
                        <a onclick="loadSyllabus('PG')" class="block px-4 py-3 hover:bg-gray-50 hover:text-brand cursor-pointer transition">Post Graduate</a>
                    </div>
                </div>

                <button onclick="loadAssignments()" class="text-gray-600 hover:text-brand font-medium flex items-center">
                    <i class="fas fa-edit mr-1"></i> Assignments
                </button>

                <button onclick="loadTimeTables()" class="text-gray-600 hover:text-brand font-medium flex items-center">
                    <i class="fas fa-calendar-alt mr-1"></i> Time Table
                </button>

                <a href="/admin" class="text-sm text-gray-400 hover:text-gray-600 ml-2 border-l pl-4 border-gray-300">
                    <i class="fas fa-cog"></i> Admin
                </a>
            </nav>
        </div>
    </header>

    <main class="flex-grow">
        <section class="bg-brand text-white pb-20 pt-10 px-4">
            <h1 class="text-3xl font-bold text-center mb-6">Find Study Material</h1>
            
            <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-xl p-6 text-gray-800">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <div class="relative">
                        <label class="text-xs font-bold text-gray-500 uppercase">Category</label>
                        <select id="sel-cat" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-brand"><option value="">Select Category</option></select>
                    </div>
                    <div class="relative">
                        <label class="text-xs font-bold text-gray-500 uppercase">Course</label>
                        <select id="sel-course" onchange="filterSubjects()" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-brand"><option value="">Select Course</option></select>
                    </div>
                    <div class="relative">
                        <label class="text-xs font-bold text-gray-500 uppercase">Semester</label>
                        <select id="sel-sem" onchange="filterSubjects()" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-brand"><option value="">Select Semester</option></select>
                    </div>
                    <div class="relative">
                        <label class="text-xs font-bold text-gray-500 uppercase">Subject</label>
                        <select id="sel-sub" onchange="searchFiles()" class="w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-brand"><option value="">All Subjects</option></select>
                    </div>
                </div>
                
                <button onclick="searchFiles()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-lg transition text-lg flex justify-center items-center shadow-lg">
                    <i class="fas fa-search mr-2"></i> Search Resources
                </button>
            </div>
        </section>

        <div class="max-w-7xl mx-auto px-4 -mt-10 mb-10 w-full">
            
            <section id="file-section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">üìö Search Results</h2>
                    <button onclick="resetPage()" class="text-sm text-red-500 hover:underline">Close</button>
                </div>
                <div id="file-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>

            <section id="syllabus-section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">üìñ Syllabus</h2>
                    <button onclick="resetPage()" class="text-sm text-red-500 hover:underline">Close</button>
                </div>
                <div id="syllabus-loader" class="text-center py-10 text-gray-500"><i class="fas fa-spinner fa-spin text-3xl"></i></div>
                <div id="syllabus-list" class="space-y-4"></div>
            </section>

            <section id="assignment-section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">üìù Assignments</h2>
                    <button onclick="resetPage()" class="text-sm text-red-500 hover:underline">Close</button>
                </div>
                <div id="assignment-loader" class="text-center py-10 text-gray-500"><i class="fas fa-spinner fa-spin text-3xl"></i></div>
                <div id="assignment-list" class="space-y-4"></div>
            </section>

            <section id="timetable-section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">üìÖ Time Tables</h2>
                    <button onclick="resetPage()" class="text-sm text-red-500 hover:underline">Close</button>
                </div>
                <div id="timetable-loader" class="text-center py-10 text-gray-500"><i class="fas fa-spinner fa-spin text-3xl"></i></div>
                <div id="timetable-list" class="space-y-4"></div>
            </section>

            <section id="notice-section">
                <div class="flex items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üì¢ Notice Board</h2>
                    <span class="ml-3 bg-red-100 text-red-600 text-xs px-2 py-1 rounded-full font-bold new-tag">LIVE</span>
                </div>
                <div id="notice-loader" class="text-center py-10 text-gray-500"><i class="fas fa-circle-notch fa-spin text-3xl"></i></div>
                <div id="notice-list" class="space-y-4"></div>
            </section>

        </div>
    </main>

    <footer class="bg-gray-800 text-white text-center py-6 mt-auto">
        <p class="text-sm opacity-75">¬© 2025 NoteHub | Made by @dipesh_yadav_05</p>
    </footer>

    <script>
        let globalSubjects = [];
        async function init() { loadOptions(); fetchNotices(); }

        async function loadOptions() {
            try {
                const res = await fetch('/api/public/options');
                const data = await res.json();
                fill('sel-cat', data.categories);
                fill('sel-course', data.courses);
                fill('sel-sem', data.semesters);
                globalSubjects = data.subjects;
                fill('sel-sub', globalSubjects);
            } catch (e) { console.error(e); }
        }

        function fill(id, items) {
            const el = document.getElementById(id);
            const first = el.options[0].outerHTML;
            el.innerHTML = first;
            if (items) items.forEach(i => {
                const opt = document.createElement('option');
                opt.value = i.name;
                opt.text = i.name;
                el.appendChild(opt);
            });
        }

        function filterSubjects() {
            const course = document.getElementById('sel-course').value;
            const sem = document.getElementById('sel-sem').value;
            const subSelect = document.getElementById('sel-sub');
            subSelect.innerHTML = '<option value="">All Subjects</option>';
            const filtered = globalSubjects.filter(s => {
                if (s.parent && s.semester) return (course === "" || s.parent === course) && (sem === "" || s.semester === sem);
                if (s.parent) return (course === "" || s.parent === course);
                return true;
            });
            filtered.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.name;
                opt.text = s.name;
                subSelect.appendChild(opt);
            });
        }

        async function searchFiles() {
            hideAllSections();
            document.getElementById('file-section').classList.remove('hidden');
            const grid = document.getElementById('file-grid');
            grid.innerHTML = '<div class="col-span-full text-center py-10"><i class="fas fa-spinner fa-spin text-2xl text-brand"></i></div>';
            const filters = {
                category: document.getElementById('sel-cat').value,
                course: document.getElementById('sel-course').value,
                semester: document.getElementById('sel-sem').value,
                subject: document.getElementById('sel-sub').value
            };
            try {
                const res = await fetch('/api/files', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(filters) });
                const files = await res.json();
                grid.innerHTML = '';
                if(files.length === 0) { grid.innerHTML = `<div class="col-span-full text-center text-gray-400 py-10 bg-white rounded shadow p-6"><i class="fas fa-folder-open text-4xl mb-2"></i><p>No files found.</p></div>`; return; }
                files.forEach(f => {
                    grid.innerHTML += `
                        <div class="bg-white rounded-lg shadow hover:shadow-lg transition p-5 border-l-4 border-brand">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-lg text-gray-800">${f.name}</h4>
                                    <p class="text-xs text-gray-500 mt-1">${f.course} ‚Ä¢ ${f.semester}</p>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mt-2 inline-block">${f.subject}</span>
                                </div>
                                <i class="fas fa-file-pdf text-red-500 text-2xl"></i>
                            </div>
                            <a href="/download/${f.file_id}" target="_blank" class="block mt-4 text-center bg-gray-100 text-gray-700 font-bold py-2 rounded hover:bg-brand hover:text-white transition"><i class="fas fa-download mr-1"></i> Download</a>
                        </div>`;
                });
            } catch (e) { console.error(e); }
        }

        async function loadSyllabus(type) {
            hideAllSections();
            document.getElementById('syllabus-section').classList.remove('hidden');
            const list = document.getElementById('syllabus-list');
            const loader = document.getElementById('syllabus-loader');
            loader.classList.remove('hidden'); list.innerHTML = '';
            try {
                const res = await fetch(`/api/syllabus?type=${type}`);
                const data = await res.json();
                loader.classList.add('hidden');
                if(data.length === 0) { list.innerHTML = '<div class="text-center text-gray-500">No syllabus found.</div>'; return; }
                data.forEach(item => {
                    list.innerHTML += `<div class="bg-white p-4 rounded shadow border-l-4 border-green-500 flex justify-between items-center hover:bg-gray-50"><div><h4 class="font-bold text-gray-800">${item.name}</h4><span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">${item.section}</span></div><a href="${item.link}" target="_blank" class="bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200 font-bold text-sm">PDF</a></div>`;
                });
            } catch(e) { console.error(e); }
        }

        async function loadAssignments() {
            hideAllSections();
            document.getElementById('assignment-section').classList.remove('hidden');
            const list = document.getElementById('assignment-list');
            const loader = document.getElementById('assignment-loader');
            loader.classList.remove('hidden'); list.innerHTML = '';
            try {
                const res = await fetch('/api/assignments');
                const data = await res.json();
                loader.classList.add('hidden');
                if(data.length === 0) { list.innerHTML = '<div class="text-center text-gray-500">No assignments found.</div>'; return; }
                data.forEach(item => {
                    list.innerHTML += `<div class="bg-white p-4 rounded shadow border-l-4 border-red-500 flex justify-between items-center hover:bg-gray-50"><div><h4 class="font-bold text-gray-800">${item.name}</h4><span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">${item.section}</span></div><a href="${item.link}" target="_blank" class="bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200 font-bold text-sm">PDF</a></div>`;
                });
            } catch(e) { console.error(e); }
        }

        async function loadTimeTables() {
            hideAllSections();
            document.getElementById('timetable-section').classList.remove('hidden');
            const list = document.getElementById('timetable-list');
            const loader = document.getElementById('timetable-loader');
            loader.classList.remove('hidden'); list.innerHTML = '';
            try {
                const res = await fetch('/api/timetables');
                const data = await res.json();
                loader.classList.add('hidden');
                if(data.length === 0) { list.innerHTML = '<div class="text-center text-gray-500">No time tables found.</div>'; return; }
                data.forEach(item => {
                    list.innerHTML += `<div class="bg-white p-4 rounded shadow border-l-4 border-purple-500 flex justify-between items-center hover:bg-gray-50"><div><h4 class="font-bold text-gray-800">${item.name}</h4><span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">${item.section}</span></div><a href="${item.link}" target="_blank" class="bg-purple-100 text-purple-700 px-3 py-1 rounded hover:bg-purple-200 font-bold text-sm">PDF</a></div>`;
                });
            } catch(e) { console.error(e); }
        }

        function hideAllSections() {
            ['file-section', 'syllabus-section', 'assignment-section', 'timetable-section', 'notice-section'].forEach(id => document.getElementById(id).classList.add('hidden'));
        }

        function resetPage() {
            hideAllSections();
            document.getElementById('notice-section').classList.remove('hidden');
            document.getElementById('sel-cat').value = "";
            document.getElementById('sel-course').value = "";
            document.getElementById('sel-sem').value = "";
            document.getElementById('sel-sub').value = "";
        }

        async function fetchNotices() {
            try {
                const res = await fetch('/api/notices');
                const notices = await res.json();
                const list = document.getElementById('notice-list');
                document.getElementById('notice-loader').classList.add('hidden');
                list.innerHTML = '';
                if (notices.length === 0) { list.innerHTML = '<div class="text-center text-gray-500">Failed to load notices.</div>'; return; }
                notices.forEach(n => {
                    let linksHtml = '';
                    n.links.forEach(l => { linksHtml += `<a href="${l.url}" target="_blank" class="inline-flex items-center bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-orange-200 mr-2 mt-2"><i class="fas fa-link mr-1"></i> ${l.text || 'View Attachment'}</a>`; });
                    list.innerHTML += `<div class="bg-white rounded-lg p-5 shadow-sm border border-gray-100 notice-card transition duration-300"><div class="flex items-start"><div class="bg-orange-500 text-white rounded-full p-2 mr-3 mt-1 shrink-0"><i class="fas fa-bell"></i></div><div class="w-full"><p class="text-gray-800 text-sm md:text-base font-medium leading-relaxed">${n.title}</p><div class="flex flex-wrap items-center mt-3 justify-between"><div class="text-xs text-gray-400 font-semibold uppercase tracking-wider"><i class="far fa-calendar-alt mr-1"></i> ${n.date}</div><div class="mt-2 md:mt-0">${linksHtml}</div></div></div></div></div>`;
                });
            } catch (e) { console.error(e); }
        }
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
